\zf{is this attack on the latest openssl? if so, please list the version}

\section{Introduction}
\label{sec:intro}

The Elliptic Curve Digital Signature Algorithm (ECDSA) \cite{Johnson2001, ansi2005} is a digital signature algorithm over elliptic curves,
    widely used in many popular applications, such as TLS \cite{rfc5246} and OpenPGP \cite{openpgp2007}, smart card \cite{smartcard2007}, and Bitcoin \cite{bitcoin2008}.
The core operation of ECDSA is the scalar multiplication of a base point (or generator) over elliptic curves
    by a random nonce (or ephemeral key),
 and its semantical security relies on the computational intractability to find the ephemeral key
        for any given pair of a scalar multiplication and a base point, i.e., the elliptic curve discrete logarithm problem (ECDLP).

However, there are side channel attacks to obtain the information on the ephemeral key,
    during the scalar multiplication.
As long as some bits of the ephemeral key are leaked,
    the private key will be recovered \cite{Nguyen2001,HG2001,Nguyen2002,Nguyen2003}.
%
%The confidentiality of this nonce is very important
%As long as parts of the nonce are revealed through the side channels,
% some efficient attacks can be launched to recover the private key .
%
Howgrave-Graham and Smart \cite{HG2001} theoretically showed that DSA is vulnerable to such partial ephemeral key exposures in 2001.
Then, Nguyen and Shparlinski \cite{Nguyen2002} improved their method with further details and gave a provable polynomial-time attack.
More importantly, they extended this theoretical attack from DSA to ECDSA \cite{Nguyen2003}.
The basic idea is to reduce the problem of private key recovery to an instance of the Hidden Number Problem
(HNP), which is further reduced to the Closest Vector Problem (CVP) or the Shortest Vector Problem (SVP) in a lattice, with the knowledge of consecutive bits of the ephemeral keys.
Brumley et al. employed this lattice attack to recover the ECDSA private keys from leaked least significant bits (LSBs) \cite{Brumley2009} or leaked most significant bits (MSBs) \cite{Brumley2011}.

%In 2003, Nguyen \cite{Nguyen2003} presented a polynomial-time algorithm that recovers the ECDSA private key when a few consecutive bits of the random nonce $k$ are known for a number of signatures, which used the similar results for the DSA \cite{Nguyen2002}.


With the Flush+Reload cache side channels \cite{flushreload},
	Benger et al. \cite{Benger2014} obtained the position of the least non-zero digit to infer the LSBs of the ephemeral key.
This side channel exploits
	the windowed Non-Adjacent Form (wNAF) implementation \cite{GORDON1998129,Miyaji1997,Koyama1002,Solinas2000}
	for the scalar multiplication	
		of a known point $G$ by the the random ephemeral key $k$.
This exploitation works for the elliptic curves over a prime field $\mathbb{F}_{p}$
			in ECDSA, which is implemented in OpenSSL\cite{openssl} and other cryptographic engines.
Then,
	by constructing an HNP instance solved by the lattice reduction algorithm, they recovered the ECDSA private key from about 200 signatures.
In 2015, Van de Pol et al. improved this attack by a more effective way of exacting information from the cache side channel \cite{Van2015},
 which exploited the information about the positions of higher half non-zero digits of the wNAF representations of the ephemeral key.
In the same year, Cao et al.~\cite{Cao2015} presented two lattice-based differential fault attacks against ECDSA with wNAF implementations.
In 2016, Goudarzi et al.~\cite{Dahmun2016}  extended this attack to the blinded ephemeral keys,
  which are protected by the addition of a random multiple of the elliptic-curve group order or by a random Euclidean splitting.
Then,
Fan et al. proposed a new way of extracting and utilizing information obtained from the Flush+Reload side channels.
 The problem of recovering the
secret key is then transformed to the Extended Hidden Number Problem (EHNP) which is also solved by lattice reduction algorithm.
The number of signatures needed is reduced to $4$ to recover the private key \cite{Fan2016}.
In 2017, Wang et al.~\cite{Wang2017} presented another lattice attack on ECDSA using
 a small fraction of information from the ephemeral key.
They exploited the positions of two non-zero digits together with the length of the wNAF representation of the ephemeral key to construct an HNP instance. They need 85 signatures to recover the private key.
%这一部分仍需要修改


%Benger et al. [22] proposed a method to extract the LSBs of the ephemeral key with the knowledge
%of double-and-add chain of the execution of scalar multiplication in ECDSA implementation via the
%Flush+Reload attack, being able to recover the private key of the secp256k1 curve using about 200 signatures
%
%It was first in 2001 that Howgrave-Graham and Smart [23] proposed
%their attack against DSA heuristically under the assumption that some consecutive leaked ephemeral
%key bits be known by side-channel attacks. In 2002, Nguyen and Shparlinski [24] analyzed their method
%in further details and gave a provable polynomial-time attack against DSA when some consecutive bits
%(e.g., the LSBs) of the ephemeral keys were leaked. They also extended their results to ECDSA [25] and
%managed to recover a 160-bit private key with 100 signatures each leaking 3 consecutive least significant
%bits. The basic idea is to reduce the key recovery problem to an instance of the hidden number problem
%(HNP), which can be further reduced to the closest vector problem (CVP) in a suitable lattice, with the
%knowledge of consecutive leaked ephemeral key bits. The best result of this method so far is achieved
%by Liu and Nguyen [26] in 2013, using the algorithm BKZ 2.0 [27], which is one of the best lattice
%reduction algorithms up to now. A 160-bit signature with 2-bit leakage of LSBs can be recovered with
%100 signatures.

%之前的工作存在哪些问题：1.2.3
%我们的工作，我们做了什么事情，详细说明，做了什么，得到了什么结果，
%先说方案，再说实现
%和之前相比，我们的效果好在了什么地方。
%然后summary贡献：

%只是对数据分析进行了改进，并没有获得更多的数据

The above works extract the information in the wNAF representation of the ephemeral key.
They tried to make better use of the data achieved through the side channels and construct more effective lattice attacks
 to recover the private key.
They extract the least non-zero digit \cite{Benger2014}, half non-zero digits \cite{Van2015}, all non-zero digits \cite{Fan2016} or two non-zero digits with the total length~\cite{Wang2017}.
In summary,
all information exploited in these attacks are the non-zero digits and the positions,
 and no more extra information about the ephemeral key is extracted from the side channels.
Although the lattice attacks are different in these works,
     no effort and improvement have been made to achieve and exploit more information.

In our paper, we also focus on ECDSA with the wNAF representation of the ephemeral key.
%, especially the implementation in the OpenSSL library.
 We propose a new method to recover the ECDSA private key from the information leaked through side channels.
We try to not only make better use of the information achieve from side channels,
  but also to extract different information from the side channels.
First, we analyse the implementation code of ECDSA in OpenSSL
 and find that
in the implementation of the scalar multiplication the invert function is another exploitable vulnerability.
It inverts a number so that the subtraction is replaced by addition and the space storing the precomputed points is reduced by half.
In the calculation, if the sign of current non-zero digit of the ephemeral key is opposite to the previous one, the invert function is called, and the absolute value of this digit is used to index the precomputed points. Otherwise, the invert function is not called.
It helps us to determine the sign of the non-zero digits of the wNAF representations.
 % by exploiting the \emph{$EC\_POINT\_invert()$} function we can improve the cache side channel attacks.
So we obtain the sign of the non-zero digits in the wNAF representations of the ephemeral key by adding a monitor to the invert function.
 Thus, we achieve more information about the ephemeral key compared to previous attacks.
After that, we manage to recover the consecutive bits at the position of every non-zero digits of the ephemeral key based on the information obtained from the cache side channels.
Finally, we construct an HNP \cite{boneh1996} instance making the best of the consecutive bits of the ephemeral key.
This problem is solved by lattice reduction algorithms  through converting to the SVP.

This attack is applied to the secp256k1 curve in OpenSSL 1.1.1b in this paper.
We choose the Flush+Flush~\cite{gruss2016flush} attack to monitor the functions of double, add and invert.
By monitoring the  invert function
	in addition to the double and add functions in OpenSSL. %	we obtain the ``double-add-invert'' chain.
We successfully extract whether each digit of the ephemeral key is zero or not,
 and determine the signs of the non-zero digits from this chain.
Then we use the BKZ \cite{Schnorr1994} algorithm to solve the HNP instance,
    and effectively recover the ECDSA private key.
If the result of the Flush+Flush attack is perfect, we need about $60$ signatures to recover the private key with a probability of $3\%$.

Through the cache side channel, we get the information about all non-zero digits of the ephemeral key, the positions and the signs.
Compared to previous works, our method obtain more information about the ephemeral key, i.e. the signs of all non-zero digits.
We extract $153.2$ bits on average per signature for 256-bit ECDSA.
In theory, the number of signatures that required is $2$ if a suitable lattice is constructed.
%It  can be applied to all the curves without any restriction.
%The sign information of non-zero digits cannot be directly applied to previous works.
%Also, our method does not rely on some special properties of the elliptic curves.
To make better use of the sign information of the non-zero digits,
 we exploit the information obtained about the wNAF representation to extract sequences of consecutive bits of $k$ to construct the lattice attack,
because the steps in existing works do not work for this information.
We have to obtain multiple consecutive bits of the ephemeral key by converting the wNAF representation to the binary representation.
And then, we use these consecutive bits to construct the HNP instance.
To the best of our knowledge, this is the first time to obtain and exploit the
signs of the wNAF representations in the side channel attacks against ECDSA,
    and previous works cannot be straightforwardly applied to this information.
%我们主要都做了什么工作，详细的描述做了什么事，实验做了什么，然后得到了什么结果
%和之前的工作相比，我们有哪些创新和改进，然后再总结本文的贡献
Our contributions are summarized as follows:
\begin{itemize}
  \item
  We present a new lattice attack to recover the private key of ECDSA with wNAF representations.
  First, we
    improve the cache side channel attacks by monitoring
      the invert function.
      It is the first work to exploit the sign of the non-zero digits of the ephemeral key in side channel attacks.
   Second, for the data from the cache side channel, we do not use them to construct the HNP instance directly,
   as in previous works.
    We obtain multiple consecutive bits of the ephemeral key by converting the wNAF representation to the binary representation.
Finally, we use these consecutive bits to construct the HNP instance.
The private key is recovered by solving the HNP instance using lattice reduction algorithm.
These steps are different from existing works.
  \item
    We apply our method to the secp256k1 curve in the latest version of OpenSSL.
     Through the cache side channel, $153.2$ bits of information per signature is obtained on average.
    The experiments show that $60$ signatures are enough to recover the private key with a probability of $3\%$.
\end{itemize}

The rest of this paper is organized as follows.
Section \ref{sec:background} presents some preliminaries.
Section \ref{sec:attack} provides the details about our attack,
and Section \ref{sec:impl&exper} shows the implementation details and the experimental results.
Section \ref{sec:discussion} contains some extended discussions.
Section \ref{sec:relatedwork} introduces some related works.
Section \ref{sec:conclusion} draws the conclusion.

%ECDSA被广泛应用
%基于椭圆曲线离散对数问题
%算法分析上难以被攻击
%但是在实现上却相对容易发现漏洞
%因此很多人通过侧信道攻击来获取软件实现上的泄露的信息，进行密钥恢复。
%Cache侧信道攻击在近年来得到广泛应用
%
%OpenSSL的实现是应用最广泛的实现。
%其中，对于素域上的椭圆曲线，使用的是wNAF算法实现的标量乘法。
%XX年，提出了对这种方式的的攻击
%XX攻击，使用Flush+Reload攻击获取了多少数据，构造了格攻击
%。。。
%在我们的文章中，我们使用了。。。做了。。。
%达到了。。。
%总的来说，本文的贡献如下：
%1、
%2、
%
%文章的剩余部分这样组织：第二章。。。。

